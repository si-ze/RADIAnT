arg_vector = list(unique = 'M:/RADICL/Data/mESCs/snakemake/results/intersects/GRID_mESC_N1_RNA_gene_intersect.txt',
multi = 'M:/RADICL/Data/mESCs/snakemake/results/intersects/GRID_mESC_N1_RNA_multi_gene_intersect.txt',
out = 'M:/RADICL/Data/mESCs/snakemake/results/intersects/GRID_mESC_N1_RNA_gene_intersect_maximums_cut.txt')
library(data.table)
library(dplyr)
library(argparser)
unique_intersect = data.table::fread(arg_vector$unique)
column_names = c('read_chr', 'read_start', 'read_stop', 'read_id', 'mapping_quality', 'read_strand',
'read_start_2', 'read_stop_2', 'rgb', 'misc', 'align_length', 'misc_2', 'gene_chr',
'gene_start', 'gene_stop', 'score', 'gene_id', 'gene_strand', 'intersect_length')
colnames(unique_intersect) = column_names
unique_intersect$gene_size = unique_intersect$gene_stop - unique_intersect$gene_start
unique_intersect$intersect_proportion = unique_intersect$intersect_length / unique_intersect$gene_size
setkey(unique_intersect, 'read_id')
data.table::setorder(unique_intersect, 'read_id')
message('Processing unique intersects')
dt_start = Sys.time()
max_unique_intersect_dt = unique_intersect[,.(gene_id = gene_id[which.max(intersect_proportion)]), by = 'read_id']
dt_end = Sys.time()
dt_duration = dt_end - dt_start
dplyr_start = Sys.time()
max_unique_intersect_dplyr = unique_intersect %>%
group_by(read_id) %>%
arrange(desc(intersect_proportion)) %>%
slice(1L) %>%
setDT()
dt_duration
